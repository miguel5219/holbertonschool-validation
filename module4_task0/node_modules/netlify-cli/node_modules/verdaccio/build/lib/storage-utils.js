"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.WHITELIST = void 0;
exports.checkPackageLocal = checkPackageLocal;
exports.checkPackageRemote = checkPackageRemote;
exports.cleanUpLinksRef = cleanUpLinksRef;
exports.cleanUpReadme = cleanUpReadme;
exports.convertAbbreviatedManifest = convertAbbreviatedManifest;
exports.generatePackageTemplate = generatePackageTemplate;
exports.generateRevision = generateRevision;
exports.getLatestReadme = getLatestReadme;
exports.hasInstallScript = hasInstallScript;
exports.isPublishablePackage = isPublishablePackage;
exports.mergeUplinkTimeIntoLocal = mergeUplinkTimeIntoLocal;
exports.normalizeContributors = normalizeContributors;
exports.normalizePackage = normalizePackage;
exports.prepareSearchPackage = prepareSearchPackage;
exports.publishPackage = publishPackage;
var _lodash = _interopRequireDefault(require("lodash"));
var _cryptoUtils = require("../lib/crypto-utils");
var _constants = require("./constants");
var _search = _interopRequireDefault(require("./search"));
var _utils = require("./utils");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function generatePackageTemplate(name) {
  return {
    // standard things
    name,
    versions: {},
    time: {},
    [_constants.USERS]: {},
    [_constants.DIST_TAGS]: {},
    _uplinks: {},
    _distfiles: {},
    _attachments: {},
    _rev: ''
  };
}

/**
 * Normalize package properties, tags, revision id.
 * @param {Object} pkg package reference.
 */
function normalizePackage(pkg) {
  const pkgProperties = ['versions', 'dist-tags', '_distfiles', '_attachments', '_uplinks', 'time'];
  pkgProperties.forEach(key => {
    const pkgProp = pkg[key];
    if (_lodash.default.isNil(pkgProp) || (0, _utils.isObject)(pkgProp) === false) {
      pkg[key] = {};
    }
  });
  if (_lodash.default.isString(pkg._rev) === false) {
    pkg._rev = _constants.STORAGE.DEFAULT_REVISION;
  }
  if (_lodash.default.isString(pkg._id) === false) {
    pkg._id = pkg.name;
  }

  // normalize dist-tags
  (0, _utils.normalizeDistTags)(pkg);
  return pkg;
}
function generateRevision(rev) {
  const _rev = rev.split('-');
  return (+_rev[0] || 0) + 1 + '-' + (0, _cryptoUtils.generateRandomHexString)();
}
function getLatestReadme(pkg) {
  const versions = pkg['versions'] || {};
  const distTags = pkg[_constants.DIST_TAGS] || {};
  // FIXME: here is a bit tricky add the types
  const latestVersion = distTags['latest'] ? versions[distTags['latest']] || {} : {};
  let readme = _lodash.default.trim(pkg.readme || latestVersion.readme || '');
  if (readme) {
    return readme;
  }

  // In case of empty readme - trying to get ANY readme in the following order: 'next','beta','alpha','test','dev','canary'
  const readmeDistTagsPriority = ['next', 'beta', 'alpha', 'test', 'dev', 'canary'];
  readmeDistTagsPriority.map(function (tag) {
    if (readme) {
      return readme;
    }
    const version = distTags[tag] ? versions[distTags[tag]] || {} : {};
    readme = _lodash.default.trim(version.readme || readme);
  });
  return readme;
}
function cleanUpReadme(version) {
  if (_lodash.default.isNil(version) === false) {
    // @ts-ignore
    delete version.readme;
  }
  return version;
}
function normalizeContributors(contributors) {
  if (_lodash.default.isNil(contributors)) {
    return [];
  } else if (contributors && _lodash.default.isArray(contributors) === false) {
    // FIXME: this branch is clearly no an array, still tsc complains
    // @ts-ignore
    return [contributors];
  } else if (_lodash.default.isString(contributors)) {
    return [{
      name: contributors
    }];
  }
  return contributors;
}
const WHITELIST = ['_rev', 'name', 'versions', 'dist-tags', 'readme', 'time', '_id', 'users'];
exports.WHITELIST = WHITELIST;
function cleanUpLinksRef(keepUpLinkData, result) {
  const propertyToKeep = [...WHITELIST];
  if (keepUpLinkData === true) {
    propertyToKeep.push('_uplinks');
  }
  for (const i in result) {
    if (propertyToKeep.indexOf(i) === -1) {
      // Remove sections like '_uplinks' from response
      delete result[i];
    }
  }
  return result;
}

/**
 * Check whether a package it is already a local package
 * @param {*} name
 * @param {*} localStorage
 */
function checkPackageLocal(name, localStorage) {
  return new Promise((resolve, reject) => {
    localStorage.getPackageMetadata(name, (err, results) => {
      if (!_lodash.default.isNil(err) && err.status !== _constants.HTTP_STATUS.NOT_FOUND) {
        return reject(err);
      }
      if (results) {
        return reject(_utils.ErrorCode.getConflict(_constants.API_ERROR.PACKAGE_EXIST));
      }
      return resolve();
    });
  });
}
function publishPackage(name, metadata, localStorage) {
  return new Promise((resolve, reject) => {
    localStorage.addPackage(name, metadata, (err, latest) => {
      if (!_lodash.default.isNull(err)) {
        return reject(err);
      } else if (!_lodash.default.isUndefined(latest)) {
        _search.default.add(latest);
      }
      return resolve();
    });
  });
}
function checkPackageRemote(name, isAllowPublishOffline, syncMetadata) {
  return new Promise((resolve, reject) => {
    syncMetadata(name, null, {}, (err, packageJsonLocal, upLinksErrors) => {
      // something weird
      if (err && err.status !== _constants.HTTP_STATUS.NOT_FOUND) {
        return reject(err);
      }

      // checking package exist already
      if (_lodash.default.isNil(packageJsonLocal) === false) {
        return reject(_utils.ErrorCode.getConflict(_constants.API_ERROR.PACKAGE_EXIST));
      }
      for (let errorItem = 0; errorItem < upLinksErrors.length; errorItem++) {
        // checking error
        // if uplink fails with a status other than 404, we report failure
        if (_lodash.default.isNil(upLinksErrors[errorItem][0]) === false) {
          if (upLinksErrors[errorItem][0].status !== _constants.HTTP_STATUS.NOT_FOUND) {
            if (isAllowPublishOffline) {
              return resolve();
            }
            return reject(_utils.ErrorCode.getServiceUnavailable(_constants.API_ERROR.UPLINK_OFFLINE_PUBLISH));
          }
        }
      }
      return resolve();
    });
  });
}
function mergeUplinkTimeIntoLocal(localMetadata, remoteMetadata) {
  if ('time' in remoteMetadata) {
    return Object.assign({}, localMetadata.time, remoteMetadata.time);
  }
  return localMetadata.time;
}
function prepareSearchPackage(data, time) {
  const listVersions = Object.keys(data.versions);
  const versions = (0, _utils.semverSort)(listVersions);
  const latest = data[_constants.DIST_TAGS] && data[_constants.DIST_TAGS].latest ? data[_constants.DIST_TAGS].latest : versions.pop();
  if (latest && data.versions[latest]) {
    const version = data.versions[latest];
    const versions = {
      [latest]: 'latest'
    };
    const pkg = {
      name: version.name,
      description: version.description,
      [_constants.DIST_TAGS]: {
        latest
      },
      maintainers: version.maintainers || [version.author].filter(Boolean),
      author: version.author,
      repository: version.repository,
      readmeFilename: version.readmeFilename || '',
      homepage: version.homepage,
      keywords: version.keywords,
      bugs: version.bugs,
      license: version.license,
      time: {
        modified: time
      },
      versions
    };
    return pkg;
  }
}

/**
 * Check whether the package metadta has enough data to be published
 * @param pkg metadata
 */
function isPublishablePackage(pkg) {
  const keys = Object.keys(pkg);
  return _lodash.default.includes(keys, 'versions');
}
function hasInstallScript(version) {
  if (version !== null && version !== void 0 && version.scripts) {
    const scripts = Object.keys(version.scripts);
    return scripts.find(item => {
      return ['install', 'preinstall', 'postinstall'].includes(item);
    }) !== undefined;
  }
  return false;
}
function convertAbbreviatedManifest(manifest) {
  var _manifest$time;
  const abbreviatedVersions = Object.keys(manifest.versions).reduce((acc, version) => {
    const _version = manifest.versions[version];
    // This should be align with this document
    // https://github.com/npm/registry/blob/master/docs/responses/package-metadata.md#abbreviated-version-object
    const _version_abbreviated = {
      name: _version.name,
      version: _version.version,
      description: _version.description,
      deprecated: _version.deprecated,
      bin: _version.bin,
      dist: _version.dist,
      engines: _version.engines,
      cpu: _version.cpu,
      os: _version.os,
      funding: _version.funding,
      directories: _version.directories,
      dependencies: _version.dependencies,
      devDependencies: _version.devDependencies,
      peerDependencies: _version.peerDependencies,
      peerDependenciesMeta: _version.peerDependenciesMeta,
      optionalDependencies: _version.optionalDependencies,
      bundleDependencies: _version.bundleDependencies,
      // npm cli specifics
      _hasShrinkwrap: _version._hasShrinkwrap,
      hasInstallScript: hasInstallScript(_version)
    };
    acc[version] = _version_abbreviated;
    return acc;
  }, {});
  const convertedManifest = {
    name: manifest['name'],
    [_constants.DIST_TAGS]: manifest[_constants.DIST_TAGS],
    versions: abbreviatedVersions,
    // @ts-ignore
    modified: manifest === null || manifest === void 0 ? void 0 : (_manifest$time = manifest.time) === null || _manifest$time === void 0 ? void 0 : _manifest$time.modified,
    // NOTE: special case for pnpm https://github.com/pnpm/rfcs/pull/2
    time: manifest === null || manifest === void 0 ? void 0 : manifest.time
  };

  // @ts-ignore
  return convertedManifest;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJnZW5lcmF0ZVBhY2thZ2VUZW1wbGF0ZSIsIm5hbWUiLCJ2ZXJzaW9ucyIsInRpbWUiLCJVU0VSUyIsIkRJU1RfVEFHUyIsIl91cGxpbmtzIiwiX2Rpc3RmaWxlcyIsIl9hdHRhY2htZW50cyIsIl9yZXYiLCJub3JtYWxpemVQYWNrYWdlIiwicGtnIiwicGtnUHJvcGVydGllcyIsImZvckVhY2giLCJrZXkiLCJwa2dQcm9wIiwiXyIsImlzTmlsIiwiaXNPYmplY3QiLCJpc1N0cmluZyIsIlNUT1JBR0UiLCJERUZBVUxUX1JFVklTSU9OIiwiX2lkIiwibm9ybWFsaXplRGlzdFRhZ3MiLCJnZW5lcmF0ZVJldmlzaW9uIiwicmV2Iiwic3BsaXQiLCJnZW5lcmF0ZVJhbmRvbUhleFN0cmluZyIsImdldExhdGVzdFJlYWRtZSIsImRpc3RUYWdzIiwibGF0ZXN0VmVyc2lvbiIsInJlYWRtZSIsInRyaW0iLCJyZWFkbWVEaXN0VGFnc1ByaW9yaXR5IiwibWFwIiwidGFnIiwidmVyc2lvbiIsImNsZWFuVXBSZWFkbWUiLCJub3JtYWxpemVDb250cmlidXRvcnMiLCJjb250cmlidXRvcnMiLCJpc0FycmF5IiwiV0hJVEVMSVNUIiwiY2xlYW5VcExpbmtzUmVmIiwia2VlcFVwTGlua0RhdGEiLCJyZXN1bHQiLCJwcm9wZXJ0eVRvS2VlcCIsInB1c2giLCJpIiwiaW5kZXhPZiIsImNoZWNrUGFja2FnZUxvY2FsIiwibG9jYWxTdG9yYWdlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJnZXRQYWNrYWdlTWV0YWRhdGEiLCJlcnIiLCJyZXN1bHRzIiwic3RhdHVzIiwiSFRUUF9TVEFUVVMiLCJOT1RfRk9VTkQiLCJFcnJvckNvZGUiLCJnZXRDb25mbGljdCIsIkFQSV9FUlJPUiIsIlBBQ0tBR0VfRVhJU1QiLCJwdWJsaXNoUGFja2FnZSIsIm1ldGFkYXRhIiwiYWRkUGFja2FnZSIsImxhdGVzdCIsImlzTnVsbCIsImlzVW5kZWZpbmVkIiwiU2VhcmNoIiwiYWRkIiwiY2hlY2tQYWNrYWdlUmVtb3RlIiwiaXNBbGxvd1B1Ymxpc2hPZmZsaW5lIiwic3luY01ldGFkYXRhIiwicGFja2FnZUpzb25Mb2NhbCIsInVwTGlua3NFcnJvcnMiLCJlcnJvckl0ZW0iLCJsZW5ndGgiLCJnZXRTZXJ2aWNlVW5hdmFpbGFibGUiLCJVUExJTktfT0ZGTElORV9QVUJMSVNIIiwibWVyZ2VVcGxpbmtUaW1lSW50b0xvY2FsIiwibG9jYWxNZXRhZGF0YSIsInJlbW90ZU1ldGFkYXRhIiwiT2JqZWN0IiwiYXNzaWduIiwicHJlcGFyZVNlYXJjaFBhY2thZ2UiLCJkYXRhIiwibGlzdFZlcnNpb25zIiwia2V5cyIsInNlbXZlclNvcnQiLCJwb3AiLCJkZXNjcmlwdGlvbiIsIm1haW50YWluZXJzIiwiYXV0aG9yIiwiZmlsdGVyIiwiQm9vbGVhbiIsInJlcG9zaXRvcnkiLCJyZWFkbWVGaWxlbmFtZSIsImhvbWVwYWdlIiwia2V5d29yZHMiLCJidWdzIiwibGljZW5zZSIsIm1vZGlmaWVkIiwiaXNQdWJsaXNoYWJsZVBhY2thZ2UiLCJpbmNsdWRlcyIsImhhc0luc3RhbGxTY3JpcHQiLCJzY3JpcHRzIiwiZmluZCIsIml0ZW0iLCJ1bmRlZmluZWQiLCJjb252ZXJ0QWJicmV2aWF0ZWRNYW5pZmVzdCIsIm1hbmlmZXN0IiwiYWJicmV2aWF0ZWRWZXJzaW9ucyIsInJlZHVjZSIsImFjYyIsIl92ZXJzaW9uIiwiX3ZlcnNpb25fYWJicmV2aWF0ZWQiLCJkZXByZWNhdGVkIiwiYmluIiwiZGlzdCIsImVuZ2luZXMiLCJjcHUiLCJvcyIsImZ1bmRpbmciLCJkaXJlY3RvcmllcyIsImRlcGVuZGVuY2llcyIsImRldkRlcGVuZGVuY2llcyIsInBlZXJEZXBlbmRlbmNpZXMiLCJwZWVyRGVwZW5kZW5jaWVzTWV0YSIsIm9wdGlvbmFsRGVwZW5kZW5jaWVzIiwiYnVuZGxlRGVwZW5kZW5jaWVzIiwiX2hhc1Nocmlua3dyYXAiLCJjb252ZXJ0ZWRNYW5pZmVzdCJdLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvc3RvcmFnZS11dGlscy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuXG5pbXBvcnQgeyBBYmJyZXZpYXRlZE1hbmlmZXN0LCBBYmJyZXZpYXRlZFZlcnNpb25zLCBBdXRob3IsIE1hbmlmZXN0LCBQYWNrYWdlLCBWZXJzaW9uIH0gZnJvbSAnQHZlcmRhY2Npby90eXBlcyc7XG5cbmltcG9ydCB7IGdlbmVyYXRlUmFuZG9tSGV4U3RyaW5nIH0gZnJvbSAnLi4vbGliL2NyeXB0by11dGlscyc7XG5pbXBvcnQgeyBJU3RvcmFnZSB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IEFQSV9FUlJPUiwgRElTVF9UQUdTLCBIVFRQX1NUQVRVUywgU1RPUkFHRSwgVVNFUlMgfSBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQgU2VhcmNoIGZyb20gJy4vc2VhcmNoJztcbmltcG9ydCB7IEVycm9yQ29kZSwgaXNPYmplY3QsIG5vcm1hbGl6ZURpc3RUYWdzLCBzZW12ZXJTb3J0IH0gZnJvbSAnLi91dGlscyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVBhY2thZ2VUZW1wbGF0ZShuYW1lOiBzdHJpbmcpOiBQYWNrYWdlIHtcbiAgcmV0dXJuIHtcbiAgICAvLyBzdGFuZGFyZCB0aGluZ3NcbiAgICBuYW1lLFxuICAgIHZlcnNpb25zOiB7fSxcbiAgICB0aW1lOiB7fSxcbiAgICBbVVNFUlNdOiB7fSxcbiAgICBbRElTVF9UQUdTXToge30sXG4gICAgX3VwbGlua3M6IHt9LFxuICAgIF9kaXN0ZmlsZXM6IHt9LFxuICAgIF9hdHRhY2htZW50czoge30sXG4gICAgX3JldjogJycsXG4gIH07XG59XG5cbi8qKlxuICogTm9ybWFsaXplIHBhY2thZ2UgcHJvcGVydGllcywgdGFncywgcmV2aXNpb24gaWQuXG4gKiBAcGFyYW0ge09iamVjdH0gcGtnIHBhY2thZ2UgcmVmZXJlbmNlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplUGFja2FnZShwa2c6IFBhY2thZ2UpOiBQYWNrYWdlIHtcbiAgY29uc3QgcGtnUHJvcGVydGllcyA9IFsndmVyc2lvbnMnLCAnZGlzdC10YWdzJywgJ19kaXN0ZmlsZXMnLCAnX2F0dGFjaG1lbnRzJywgJ191cGxpbmtzJywgJ3RpbWUnXTtcblxuICBwa2dQcm9wZXJ0aWVzLmZvckVhY2goKGtleSk6IHZvaWQgPT4ge1xuICAgIGNvbnN0IHBrZ1Byb3AgPSBwa2dba2V5XTtcblxuICAgIGlmIChfLmlzTmlsKHBrZ1Byb3ApIHx8IGlzT2JqZWN0KHBrZ1Byb3ApID09PSBmYWxzZSkge1xuICAgICAgcGtnW2tleV0gPSB7fTtcbiAgICB9XG4gIH0pO1xuXG4gIGlmIChfLmlzU3RyaW5nKHBrZy5fcmV2KSA9PT0gZmFsc2UpIHtcbiAgICBwa2cuX3JldiA9IFNUT1JBR0UuREVGQVVMVF9SRVZJU0lPTjtcbiAgfVxuXG4gIGlmIChfLmlzU3RyaW5nKHBrZy5faWQpID09PSBmYWxzZSkge1xuICAgIHBrZy5faWQgPSBwa2cubmFtZTtcbiAgfVxuXG4gIC8vIG5vcm1hbGl6ZSBkaXN0LXRhZ3NcbiAgbm9ybWFsaXplRGlzdFRhZ3MocGtnKTtcblxuICByZXR1cm4gcGtnO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVSZXZpc2lvbihyZXY6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IF9yZXYgPSByZXYuc3BsaXQoJy0nKTtcblxuICByZXR1cm4gKCtfcmV2WzBdIHx8IDApICsgMSArICctJyArIGdlbmVyYXRlUmFuZG9tSGV4U3RyaW5nKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRMYXRlc3RSZWFkbWUocGtnOiBQYWNrYWdlKTogc3RyaW5nIHtcbiAgY29uc3QgdmVyc2lvbnMgPSBwa2dbJ3ZlcnNpb25zJ10gfHwge307XG4gIGNvbnN0IGRpc3RUYWdzID0gcGtnW0RJU1RfVEFHU10gfHwge307XG4gIC8vIEZJWE1FOiBoZXJlIGlzIGEgYml0IHRyaWNreSBhZGQgdGhlIHR5cGVzXG4gIGNvbnN0IGxhdGVzdFZlcnNpb246IFZlcnNpb24gfCBhbnkgPSBkaXN0VGFnc1snbGF0ZXN0J10gPyB2ZXJzaW9uc1tkaXN0VGFnc1snbGF0ZXN0J11dIHx8IHt9IDoge307XG4gIGxldCByZWFkbWUgPSBfLnRyaW0ocGtnLnJlYWRtZSB8fCBsYXRlc3RWZXJzaW9uLnJlYWRtZSB8fCAnJyk7XG4gIGlmIChyZWFkbWUpIHtcbiAgICByZXR1cm4gcmVhZG1lO1xuICB9XG5cbiAgLy8gSW4gY2FzZSBvZiBlbXB0eSByZWFkbWUgLSB0cnlpbmcgdG8gZ2V0IEFOWSByZWFkbWUgaW4gdGhlIGZvbGxvd2luZyBvcmRlcjogJ25leHQnLCdiZXRhJywnYWxwaGEnLCd0ZXN0JywnZGV2JywnY2FuYXJ5J1xuICBjb25zdCByZWFkbWVEaXN0VGFnc1ByaW9yaXR5ID0gWyduZXh0JywgJ2JldGEnLCAnYWxwaGEnLCAndGVzdCcsICdkZXYnLCAnY2FuYXJ5J107XG4gIHJlYWRtZURpc3RUYWdzUHJpb3JpdHkubWFwKGZ1bmN0aW9uICh0YWcpOiBzdHJpbmcgfCB2b2lkIHtcbiAgICBpZiAocmVhZG1lKSB7XG4gICAgICByZXR1cm4gcmVhZG1lO1xuICAgIH1cbiAgICBjb25zdCB2ZXJzaW9uOiBWZXJzaW9uIHwgYW55ID0gZGlzdFRhZ3NbdGFnXSA/IHZlcnNpb25zW2Rpc3RUYWdzW3RhZ11dIHx8IHt9IDoge307XG4gICAgcmVhZG1lID0gXy50cmltKHZlcnNpb24ucmVhZG1lIHx8IHJlYWRtZSk7XG4gIH0pO1xuICByZXR1cm4gcmVhZG1lO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xlYW5VcFJlYWRtZSh2ZXJzaW9uOiBWZXJzaW9uKTogVmVyc2lvbiB7XG4gIGlmIChfLmlzTmlsKHZlcnNpb24pID09PSBmYWxzZSkge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBkZWxldGUgdmVyc2lvbi5yZWFkbWU7XG4gIH1cblxuICByZXR1cm4gdmVyc2lvbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZUNvbnRyaWJ1dG9ycyhjb250cmlidXRvcnM6IEF1dGhvcltdKTogQXV0aG9yW10ge1xuICBpZiAoXy5pc05pbChjb250cmlidXRvcnMpKSB7XG4gICAgcmV0dXJuIFtdO1xuICB9IGVsc2UgaWYgKGNvbnRyaWJ1dG9ycyAmJiBfLmlzQXJyYXkoY29udHJpYnV0b3JzKSA9PT0gZmFsc2UpIHtcbiAgICAvLyBGSVhNRTogdGhpcyBicmFuY2ggaXMgY2xlYXJseSBubyBhbiBhcnJheSwgc3RpbGwgdHNjIGNvbXBsYWluc1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICByZXR1cm4gW2NvbnRyaWJ1dG9yc107XG4gIH0gZWxzZSBpZiAoXy5pc1N0cmluZyhjb250cmlidXRvcnMpKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIHtcbiAgICAgICAgbmFtZTogY29udHJpYnV0b3JzLFxuICAgICAgfSxcbiAgICBdO1xuICB9XG5cbiAgcmV0dXJuIGNvbnRyaWJ1dG9ycztcbn1cblxuZXhwb3J0IGNvbnN0IFdISVRFTElTVCA9IFsnX3JldicsICduYW1lJywgJ3ZlcnNpb25zJywgJ2Rpc3QtdGFncycsICdyZWFkbWUnLCAndGltZScsICdfaWQnLCAndXNlcnMnXTtcblxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFuVXBMaW5rc1JlZihrZWVwVXBMaW5rRGF0YTogYm9vbGVhbiwgcmVzdWx0OiBQYWNrYWdlKTogUGFja2FnZSB7XG4gIGNvbnN0IHByb3BlcnR5VG9LZWVwID0gWy4uLldISVRFTElTVF07XG4gIGlmIChrZWVwVXBMaW5rRGF0YSA9PT0gdHJ1ZSkge1xuICAgIHByb3BlcnR5VG9LZWVwLnB1c2goJ191cGxpbmtzJyk7XG4gIH1cblxuICBmb3IgKGNvbnN0IGkgaW4gcmVzdWx0KSB7XG4gICAgaWYgKHByb3BlcnR5VG9LZWVwLmluZGV4T2YoaSkgPT09IC0xKSB7XG4gICAgICAvLyBSZW1vdmUgc2VjdGlvbnMgbGlrZSAnX3VwbGlua3MnIGZyb20gcmVzcG9uc2VcbiAgICAgIGRlbGV0ZSByZXN1bHRbaV07XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLyoqXG4gKiBDaGVjayB3aGV0aGVyIGEgcGFja2FnZSBpdCBpcyBhbHJlYWR5IGEgbG9jYWwgcGFja2FnZVxuICogQHBhcmFtIHsqfSBuYW1lXG4gKiBAcGFyYW0geyp9IGxvY2FsU3RvcmFnZVxuICovXG5leHBvcnQgZnVuY3Rpb24gY2hlY2tQYWNrYWdlTG9jYWwobmFtZTogc3RyaW5nLCBsb2NhbFN0b3JhZ2U6IElTdG9yYWdlKTogUHJvbWlzZTx2b2lkPiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KTogdm9pZCA9PiB7XG4gICAgbG9jYWxTdG9yYWdlLmdldFBhY2thZ2VNZXRhZGF0YShuYW1lLCAoZXJyLCByZXN1bHRzKTogdm9pZCA9PiB7XG4gICAgICBpZiAoIV8uaXNOaWwoZXJyKSAmJiBlcnIuc3RhdHVzICE9PSBIVFRQX1NUQVRVUy5OT1RfRk9VTkQpIHtcbiAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xuICAgICAgfVxuICAgICAgaWYgKHJlc3VsdHMpIHtcbiAgICAgICAgcmV0dXJuIHJlamVjdChFcnJvckNvZGUuZ2V0Q29uZmxpY3QoQVBJX0VSUk9SLlBBQ0tBR0VfRVhJU1QpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXNvbHZlKCk7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcHVibGlzaFBhY2thZ2UobmFtZTogc3RyaW5nLCBtZXRhZGF0YTogYW55LCBsb2NhbFN0b3JhZ2U6IElTdG9yYWdlKTogUHJvbWlzZTx2b2lkPiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KTogdm9pZCA9PiB7XG4gICAgbG9jYWxTdG9yYWdlLmFkZFBhY2thZ2UobmFtZSwgbWV0YWRhdGEsIChlcnIsIGxhdGVzdCk6IHZvaWQgPT4ge1xuICAgICAgaWYgKCFfLmlzTnVsbChlcnIpKSB7XG4gICAgICAgIHJldHVybiByZWplY3QoZXJyKTtcbiAgICAgIH0gZWxzZSBpZiAoIV8uaXNVbmRlZmluZWQobGF0ZXN0KSkge1xuICAgICAgICBTZWFyY2guYWRkKGxhdGVzdCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzb2x2ZSgpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNoZWNrUGFja2FnZVJlbW90ZShuYW1lOiBzdHJpbmcsIGlzQWxsb3dQdWJsaXNoT2ZmbGluZTogYm9vbGVhbiwgc3luY01ldGFkYXRhOiBGdW5jdGlvbik6IFByb21pc2U8dm9pZD4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCk6IHZvaWQgPT4ge1xuICAgIHN5bmNNZXRhZGF0YShuYW1lLCBudWxsLCB7fSwgKGVyciwgcGFja2FnZUpzb25Mb2NhbCwgdXBMaW5rc0Vycm9ycyk6IHZvaWQgPT4ge1xuICAgICAgLy8gc29tZXRoaW5nIHdlaXJkXG4gICAgICBpZiAoZXJyICYmIGVyci5zdGF0dXMgIT09IEhUVFBfU1RBVFVTLk5PVF9GT1VORCkge1xuICAgICAgICByZXR1cm4gcmVqZWN0KGVycik7XG4gICAgICB9XG5cbiAgICAgIC8vIGNoZWNraW5nIHBhY2thZ2UgZXhpc3QgYWxyZWFkeVxuICAgICAgaWYgKF8uaXNOaWwocGFja2FnZUpzb25Mb2NhbCkgPT09IGZhbHNlKSB7XG4gICAgICAgIHJldHVybiByZWplY3QoRXJyb3JDb2RlLmdldENvbmZsaWN0KEFQSV9FUlJPUi5QQUNLQUdFX0VYSVNUKSk7XG4gICAgICB9XG5cbiAgICAgIGZvciAobGV0IGVycm9ySXRlbSA9IDA7IGVycm9ySXRlbSA8IHVwTGlua3NFcnJvcnMubGVuZ3RoOyBlcnJvckl0ZW0rKykge1xuICAgICAgICAvLyBjaGVja2luZyBlcnJvclxuICAgICAgICAvLyBpZiB1cGxpbmsgZmFpbHMgd2l0aCBhIHN0YXR1cyBvdGhlciB0aGFuIDQwNCwgd2UgcmVwb3J0IGZhaWx1cmVcbiAgICAgICAgaWYgKF8uaXNOaWwodXBMaW5rc0Vycm9yc1tlcnJvckl0ZW1dWzBdKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICBpZiAodXBMaW5rc0Vycm9yc1tlcnJvckl0ZW1dWzBdLnN0YXR1cyAhPT0gSFRUUF9TVEFUVVMuTk9UX0ZPVU5EKSB7XG4gICAgICAgICAgICBpZiAoaXNBbGxvd1B1Ymxpc2hPZmZsaW5lKSB7XG4gICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiByZWplY3QoRXJyb3JDb2RlLmdldFNlcnZpY2VVbmF2YWlsYWJsZShBUElfRVJST1IuVVBMSU5LX09GRkxJTkVfUFVCTElTSCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzb2x2ZSgpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1lcmdlVXBsaW5rVGltZUludG9Mb2NhbChsb2NhbE1ldGFkYXRhOiBQYWNrYWdlLCByZW1vdGVNZXRhZGF0YTogUGFja2FnZSk6IGFueSB7XG4gIGlmICgndGltZScgaW4gcmVtb3RlTWV0YWRhdGEpIHtcbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgbG9jYWxNZXRhZGF0YS50aW1lLCByZW1vdGVNZXRhZGF0YS50aW1lKTtcbiAgfVxuXG4gIHJldHVybiBsb2NhbE1ldGFkYXRhLnRpbWU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcmVwYXJlU2VhcmNoUGFja2FnZShkYXRhOiBQYWNrYWdlLCB0aW1lOiB1bmtub3duKTogYW55IHtcbiAgY29uc3QgbGlzdFZlcnNpb25zOiBzdHJpbmdbXSA9IE9iamVjdC5rZXlzKGRhdGEudmVyc2lvbnMpO1xuICBjb25zdCB2ZXJzaW9uczogc3RyaW5nW10gPSBzZW12ZXJTb3J0KGxpc3RWZXJzaW9ucyk7XG4gIGNvbnN0IGxhdGVzdDogc3RyaW5nIHwgdW5kZWZpbmVkID0gZGF0YVtESVNUX1RBR1NdICYmIGRhdGFbRElTVF9UQUdTXS5sYXRlc3QgPyBkYXRhW0RJU1RfVEFHU10ubGF0ZXN0IDogdmVyc2lvbnMucG9wKCk7XG5cbiAgaWYgKGxhdGVzdCAmJiBkYXRhLnZlcnNpb25zW2xhdGVzdF0pIHtcbiAgICBjb25zdCB2ZXJzaW9uOiBWZXJzaW9uID0gZGF0YS52ZXJzaW9uc1tsYXRlc3RdO1xuICAgIGNvbnN0IHZlcnNpb25zOiBhbnkgPSB7IFtsYXRlc3RdOiAnbGF0ZXN0JyB9O1xuICAgIGNvbnN0IHBrZzogYW55ID0ge1xuICAgICAgbmFtZTogdmVyc2lvbi5uYW1lLFxuICAgICAgZGVzY3JpcHRpb246IHZlcnNpb24uZGVzY3JpcHRpb24sXG4gICAgICBbRElTVF9UQUdTXTogeyBsYXRlc3QgfSxcbiAgICAgIG1haW50YWluZXJzOiB2ZXJzaW9uLm1haW50YWluZXJzIHx8IFt2ZXJzaW9uLmF1dGhvcl0uZmlsdGVyKEJvb2xlYW4pLFxuICAgICAgYXV0aG9yOiB2ZXJzaW9uLmF1dGhvcixcbiAgICAgIHJlcG9zaXRvcnk6IHZlcnNpb24ucmVwb3NpdG9yeSxcbiAgICAgIHJlYWRtZUZpbGVuYW1lOiB2ZXJzaW9uLnJlYWRtZUZpbGVuYW1lIHx8ICcnLFxuICAgICAgaG9tZXBhZ2U6IHZlcnNpb24uaG9tZXBhZ2UsXG4gICAgICBrZXl3b3JkczogdmVyc2lvbi5rZXl3b3JkcyxcbiAgICAgIGJ1Z3M6IHZlcnNpb24uYnVncyxcbiAgICAgIGxpY2Vuc2U6IHZlcnNpb24ubGljZW5zZSxcbiAgICAgIHRpbWU6IHtcbiAgICAgICAgbW9kaWZpZWQ6IHRpbWUsXG4gICAgICB9LFxuICAgICAgdmVyc2lvbnMsXG4gICAgfTtcblxuICAgIHJldHVybiBwa2c7XG4gIH1cbn1cblxuLyoqXG4gKiBDaGVjayB3aGV0aGVyIHRoZSBwYWNrYWdlIG1ldGFkdGEgaGFzIGVub3VnaCBkYXRhIHRvIGJlIHB1Ymxpc2hlZFxuICogQHBhcmFtIHBrZyBtZXRhZGF0YVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNQdWJsaXNoYWJsZVBhY2thZ2UocGtnOiBQYWNrYWdlKTogYm9vbGVhbiB7XG4gIGNvbnN0IGtleXM6IHN0cmluZ1tdID0gT2JqZWN0LmtleXMocGtnKTtcblxuICByZXR1cm4gXy5pbmNsdWRlcyhrZXlzLCAndmVyc2lvbnMnKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhc0luc3RhbGxTY3JpcHQodmVyc2lvbjogVmVyc2lvbikge1xuICBpZiAodmVyc2lvbj8uc2NyaXB0cykge1xuICAgIGNvbnN0IHNjcmlwdHMgPSBPYmplY3Qua2V5cyh2ZXJzaW9uLnNjcmlwdHMpO1xuICAgIHJldHVybiAoXG4gICAgICBzY3JpcHRzLmZpbmQoKGl0ZW0pID0+IHtcbiAgICAgICAgcmV0dXJuIFsnaW5zdGFsbCcsICdwcmVpbnN0YWxsJywgJ3Bvc3RpbnN0YWxsJ10uaW5jbHVkZXMoaXRlbSk7XG4gICAgICB9KSAhPT0gdW5kZWZpbmVkXG4gICAgKTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0QWJicmV2aWF0ZWRNYW5pZmVzdChtYW5pZmVzdDogTWFuaWZlc3QpOiBBYmJyZXZpYXRlZE1hbmlmZXN0IHtcbiAgY29uc3QgYWJicmV2aWF0ZWRWZXJzaW9ucyA9IE9iamVjdC5rZXlzKG1hbmlmZXN0LnZlcnNpb25zKS5yZWR1Y2UoKGFjYzogQWJicmV2aWF0ZWRWZXJzaW9ucywgdmVyc2lvbjogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgX3ZlcnNpb24gPSBtYW5pZmVzdC52ZXJzaW9uc1t2ZXJzaW9uXTtcbiAgICAvLyBUaGlzIHNob3VsZCBiZSBhbGlnbiB3aXRoIHRoaXMgZG9jdW1lbnRcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vbnBtL3JlZ2lzdHJ5L2Jsb2IvbWFzdGVyL2RvY3MvcmVzcG9uc2VzL3BhY2thZ2UtbWV0YWRhdGEubWQjYWJicmV2aWF0ZWQtdmVyc2lvbi1vYmplY3RcbiAgICBjb25zdCBfdmVyc2lvbl9hYmJyZXZpYXRlZCA9IHtcbiAgICAgIG5hbWU6IF92ZXJzaW9uLm5hbWUsXG4gICAgICB2ZXJzaW9uOiBfdmVyc2lvbi52ZXJzaW9uLFxuICAgICAgZGVzY3JpcHRpb246IF92ZXJzaW9uLmRlc2NyaXB0aW9uLFxuICAgICAgZGVwcmVjYXRlZDogX3ZlcnNpb24uZGVwcmVjYXRlZCxcbiAgICAgIGJpbjogX3ZlcnNpb24uYmluLFxuICAgICAgZGlzdDogX3ZlcnNpb24uZGlzdCxcbiAgICAgIGVuZ2luZXM6IF92ZXJzaW9uLmVuZ2luZXMsXG4gICAgICBjcHU6IF92ZXJzaW9uLmNwdSxcbiAgICAgIG9zOiBfdmVyc2lvbi5vcyxcbiAgICAgIGZ1bmRpbmc6IF92ZXJzaW9uLmZ1bmRpbmcsXG4gICAgICBkaXJlY3RvcmllczogX3ZlcnNpb24uZGlyZWN0b3JpZXMsXG4gICAgICBkZXBlbmRlbmNpZXM6IF92ZXJzaW9uLmRlcGVuZGVuY2llcyxcbiAgICAgIGRldkRlcGVuZGVuY2llczogX3ZlcnNpb24uZGV2RGVwZW5kZW5jaWVzLFxuICAgICAgcGVlckRlcGVuZGVuY2llczogX3ZlcnNpb24ucGVlckRlcGVuZGVuY2llcyxcbiAgICAgIHBlZXJEZXBlbmRlbmNpZXNNZXRhOiBfdmVyc2lvbi5wZWVyRGVwZW5kZW5jaWVzTWV0YSxcbiAgICAgIG9wdGlvbmFsRGVwZW5kZW5jaWVzOiBfdmVyc2lvbi5vcHRpb25hbERlcGVuZGVuY2llcyxcbiAgICAgIGJ1bmRsZURlcGVuZGVuY2llczogX3ZlcnNpb24uYnVuZGxlRGVwZW5kZW5jaWVzLFxuICAgICAgLy8gbnBtIGNsaSBzcGVjaWZpY3NcbiAgICAgIF9oYXNTaHJpbmt3cmFwOiBfdmVyc2lvbi5faGFzU2hyaW5rd3JhcCxcbiAgICAgIGhhc0luc3RhbGxTY3JpcHQ6IGhhc0luc3RhbGxTY3JpcHQoX3ZlcnNpb24pLFxuICAgIH07XG4gICAgYWNjW3ZlcnNpb25dID0gX3ZlcnNpb25fYWJicmV2aWF0ZWQ7XG4gICAgcmV0dXJuIGFjYztcbiAgfSwge30pO1xuICBjb25zdCBjb252ZXJ0ZWRNYW5pZmVzdCA9IHtcbiAgICBuYW1lOiBtYW5pZmVzdFsnbmFtZSddLFxuICAgIFtESVNUX1RBR1NdOiBtYW5pZmVzdFtESVNUX1RBR1NdLFxuICAgIHZlcnNpb25zOiBhYmJyZXZpYXRlZFZlcnNpb25zLFxuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBtb2RpZmllZDogbWFuaWZlc3Q/LnRpbWU/Lm1vZGlmaWVkLFxuICAgIC8vIE5PVEU6IHNwZWNpYWwgY2FzZSBmb3IgcG5wbSBodHRwczovL2dpdGh1Yi5jb20vcG5wbS9yZmNzL3B1bGwvMlxuICAgIHRpbWU6IG1hbmlmZXN0Py50aW1lLFxuICB9O1xuXG4gIC8vIEB0cy1pZ25vcmVcbiAgcmV0dXJuIGNvbnZlcnRlZE1hbmlmZXN0O1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUlBO0FBRUE7QUFDQTtBQUNBO0FBQTZFO0FBRXRFLFNBQVNBLHVCQUF1QixDQUFDQyxJQUFZLEVBQVc7RUFDN0QsT0FBTztJQUNMO0lBQ0FBLElBQUk7SUFDSkMsUUFBUSxFQUFFLENBQUMsQ0FBQztJQUNaQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQ1IsQ0FBQ0MsZ0JBQUssR0FBRyxDQUFDLENBQUM7SUFDWCxDQUFDQyxvQkFBUyxHQUFHLENBQUMsQ0FBQztJQUNmQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO0lBQ1pDLFVBQVUsRUFBRSxDQUFDLENBQUM7SUFDZEMsWUFBWSxFQUFFLENBQUMsQ0FBQztJQUNoQkMsSUFBSSxFQUFFO0VBQ1IsQ0FBQztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ08sU0FBU0MsZ0JBQWdCLENBQUNDLEdBQVksRUFBVztFQUN0RCxNQUFNQyxhQUFhLEdBQUcsQ0FBQyxVQUFVLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxjQUFjLEVBQUUsVUFBVSxFQUFFLE1BQU0sQ0FBQztFQUVqR0EsYUFBYSxDQUFDQyxPQUFPLENBQUVDLEdBQUcsSUFBVztJQUNuQyxNQUFNQyxPQUFPLEdBQUdKLEdBQUcsQ0FBQ0csR0FBRyxDQUFDO0lBRXhCLElBQUlFLGVBQUMsQ0FBQ0MsS0FBSyxDQUFD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