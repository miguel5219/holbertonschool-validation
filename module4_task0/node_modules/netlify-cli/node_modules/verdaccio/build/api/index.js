"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _compression = _interopRequireDefault(require("compression"));
var _cors = _interopRequireDefault(require("cors"));
var _express = _interopRequireDefault(require("express"));
var _lodash = _interopRequireDefault(require("lodash"));
var _auth = _interopRequireDefault(require("../lib/auth"));
var _config = _interopRequireDefault(require("../lib/config"));
var _constants = require("../lib/constants");
var _logger = require("../lib/logger");
var _pluginLoader = _interopRequireDefault(require("../lib/plugin-loader"));
var _storage = _interopRequireDefault(require("../lib/storage"));
var _utils = require("../lib/utils");
var _debug = _interopRequireDefault(require("./debug"));
var _endpoint = _interopRequireDefault(require("./endpoint"));
var _middleware = require("./middleware");
var _web = _interopRequireDefault(require("./web"));
var _api = _interopRequireDefault(require("./web/api"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
const defineAPI = function (config, storage) {
  var _config$server;
  const auth = new _auth.default(config);
  const app = (0, _express.default)();

  // run in production mode by default, just in case
  // it shouldn't make any difference anyway
  app.set('env', process.env.NODE_ENV || 'production');

  // Allow `req.ip` to resolve properly when Verdaccio is behind a proxy or load-balancer
  // See: https://expressjs.com/en/guide/behind-proxies.html
  if ((_config$server = config.server) !== null && _config$server !== void 0 && _config$server.trustProxy) {
    app.set('trust proxy', config.server.trustProxy);
  }
  app.use((0, _cors.default)());

  // Router setup
  app.use((0, _middleware.log)(config));
  app.use(_middleware.errorReportingMiddleware);
  if (config.user_agent) {
    app.use(function (req, res, next) {
      res.setHeader('X-Powered-By', (0, _utils.getUserAgent)(config.user_agent));
      next();
    });
  } else {
    app.disable('x-powered-by');
  }
  app.use((0, _compression.default)());
  app.get('/-/static/favicon.ico', (0, _middleware.serveFavicon)(config));

  // Hook for tests only
  if (config._debug) {
    (0, _debug.default)(app, config.self_path);
  }

  // register middleware plugins
  const plugin_params = {
    config: config,
    logger: _logger.logger
  };
  const plugins = (0, _pluginLoader.default)(config, config.middlewares, plugin_params, function (plugin) {
    return plugin.register_middlewares;
  });
  plugins.forEach(plugin => {
    plugin.register_middlewares(app, auth, storage);
  });

  // For  npm request
  app.use((0, _endpoint.default)(config, auth, storage));

  // For WebUI & WebUI API
  if (_lodash.default.get(config, 'web.enable', true)) {
    app.use('/', (0, _web.default)(config, auth, storage));
    app.use('/-/verdaccio/', (0, _api.default)(config, auth, storage));
  } else {
    app.get('/', function (req, res, next) {
      next(_utils.ErrorCode.getNotFound(_constants.API_ERROR.WEB_DISABLED));
    });
  }

  // Catch 404
  app.get('/*', function (req, res, next) {
    next(_utils.ErrorCode.getNotFound(_constants.API_ERROR.FILE_NOT_FOUND));
  });
  app.use(function (err, req, res, next) {
    if (_lodash.default.isError(err)) {
      if (err.code === 'ECONNABORT' && res.statusCode === _constants.HTTP_STATUS.NOT_MODIFIED) {
        return next();
      }
      if (_lodash.default.isFunction(res.locals.report_error) === false) {
        // in case of very early error this middleware may not be loaded before error is generated
        // fixing that
        (0, _middleware.errorReportingMiddleware)(req, res, _lodash.default.noop);
      }
      res.locals.report_error(err);
    } else {
      // Fall to Middleware.final
      return next(err);
    }
  });
  app.use(_middleware.final);
  return app;
};
var _default = async function _default(configHash) {
  (0, _logger.setup)(configHash.logs);
  const config = new _config.default(_lodash.default.cloneDeep(configHash));
  // register middleware plugins
  const plugin_params = {
    config: config,
    logger: _logger.logger
  };
  const filters = (0, _pluginLoader.default)(config, config.filters || {}, plugin_params, plugin => plugin.filter_metadata);
  const storage = new _storage.default(config);
  // waits until init calls have been initialized
  await storage.init(config, filters);
  return defineAPI(config, storage);
};
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkZWZpbmVBUEkiLCJjb25maWciLCJzdG9yYWdlIiwiYXV0aCIsIkF1dGgiLCJhcHAiLCJleHByZXNzIiwic2V0IiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwic2VydmVyIiwidHJ1c3RQcm94eSIsInVzZSIsImNvcnMiLCJsb2ciLCJlcnJvclJlcG9ydGluZ01pZGRsZXdhcmUiLCJ1c2VyX2FnZW50IiwicmVxIiwicmVzIiwibmV4dCIsInNldEhlYWRlciIsImdldFVzZXJBZ2VudCIsImRpc2FibGUiLCJjb21wcmVzc2lvbiIsImdldCIsInNlcnZlRmF2aWNvbiIsIl9kZWJ1ZyIsImhvb2tEZWJ1ZyIsInNlbGZfcGF0aCIsInBsdWdpbl9wYXJhbXMiLCJsb2dnZXIiLCJwbHVnaW5zIiwibG9hZFBsdWdpbiIsIm1pZGRsZXdhcmVzIiwicGx1Z2luIiwicmVnaXN0ZXJfbWlkZGxld2FyZXMiLCJmb3JFYWNoIiwiYXBpRW5kcG9pbnQiLCJfIiwid2ViIiwid2ViQVBJIiwiRXJyb3JDb2RlIiwiZ2V0Tm90Rm91bmQiLCJBUElfRVJST1IiLCJXRUJfRElTQUJMRUQiLCJGSUxFX05PVF9GT1VORCIsImVyciIsImlzRXJyb3IiLCJjb2RlIiwic3RhdHVzQ29kZSIsIkhUVFBfU1RBVFVTIiwiTk9UX01PRElGSUVEIiwiaXNGdW5jdGlvbiIsImxvY2FscyIsInJlcG9ydF9lcnJvciIsIm5vb3AiLCJmaW5hbCIsImNvbmZpZ0hhc2giLCJzZXR1cCIsImxvZ3MiLCJBcHBDb25maWciLCJjbG9uZURlZXAiLCJmaWx0ZXJzIiwiZmlsdGVyX21ldGFkYXRhIiwiU3RvcmFnZSIsImluaXQiXSwic291cmNlcyI6WyIuLi8uLi9zcmMvYXBpL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjb21wcmVzc2lvbiBmcm9tICdjb21wcmVzc2lvbic7XG5pbXBvcnQgY29ycyBmcm9tICdjb3JzJztcbmltcG9ydCBleHByZXNzLCB7IEFwcGxpY2F0aW9uIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyBIdHRwRXJyb3IgfSBmcm9tICdodHRwLWVycm9ycyc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuXG5pbXBvcnQgeyBDb25maWcgYXMgSUNvbmZpZywgSVBsdWdpbk1pZGRsZXdhcmUsIElQbHVnaW5TdG9yYWdlRmlsdGVyIH0gZnJvbSAnQHZlcmRhY2Npby90eXBlcyc7XG5cbmltcG9ydCBBdXRoIGZyb20gJy4uL2xpYi9hdXRoJztcbmltcG9ydCBBcHBDb25maWcgZnJvbSAnLi4vbGliL2NvbmZpZyc7XG5pbXBvcnQgeyBBUElfRVJST1IsIEhUVFBfU1RBVFVTIH0gZnJvbSAnLi4vbGliL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBsb2dnZXIsIHNldHVwIH0gZnJvbSAnLi4vbGliL2xvZ2dlcic7XG5pbXBvcnQgbG9hZFBsdWdpbiBmcm9tICcuLi9saWIvcGx1Z2luLWxvYWRlcic7XG5pbXBvcnQgU3RvcmFnZSBmcm9tICcuLi9saWIvc3RvcmFnZSc7XG5pbXBvcnQgeyBFcnJvckNvZGUsIGdldFVzZXJBZ2VudCB9IGZyb20gJy4uL2xpYi91dGlscyc7XG5pbXBvcnQgeyAkTmV4dEZ1bmN0aW9uVmVyLCAkUmVxdWVzdEV4dGVuZCwgJFJlc3BvbnNlRXh0ZW5kLCBJQXV0aCwgSVN0b3JhZ2VIYW5kbGVyIH0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IGhvb2tEZWJ1ZyBmcm9tICcuL2RlYnVnJztcbmltcG9ydCBhcGlFbmRwb2ludCBmcm9tICcuL2VuZHBvaW50JztcbmltcG9ydCB7IGVycm9yUmVwb3J0aW5nTWlkZGxld2FyZSwgZmluYWwsIGxvZywgc2VydmVGYXZpY29uIH0gZnJvbSAnLi9taWRkbGV3YXJlJztcbmltcG9ydCB3ZWIgZnJvbSAnLi93ZWInO1xuaW1wb3J0IHdlYkFQSSBmcm9tICcuL3dlYi9hcGknO1xuXG5jb25zdCBkZWZpbmVBUEkgPSBmdW5jdGlvbiAoY29uZmlnOiBJQ29uZmlnLCBzdG9yYWdlOiBJU3RvcmFnZUhhbmRsZXIpOiBhbnkge1xuICBjb25zdCBhdXRoOiBJQXV0aCA9IG5ldyBBdXRoKGNvbmZpZyk7XG4gIGNvbnN0IGFwcDogQXBwbGljYXRpb24gPSBleHByZXNzKCk7XG5cbiAgLy8gcnVuIGluIHByb2R1Y3Rpb24gbW9kZSBieSBkZWZhdWx0LCBqdXN0IGluIGNhc2VcbiAgLy8gaXQgc2hvdWxkbid0IG1ha2UgYW55IGRpZmZlcmVuY2UgYW55d2F5XG4gIGFwcC5zZXQoJ2VudicsIHByb2Nlc3MuZW52Lk5PREVfRU5WIHx8ICdwcm9kdWN0aW9uJyk7XG5cbiAgLy8gQWxsb3cgYHJlcS5pcGAgdG8gcmVzb2x2ZSBwcm9wZXJseSB3aGVuIFZlcmRhY2NpbyBpcyBiZWhpbmQgYSBwcm94eSBvciBsb2FkLWJhbGFuY2VyXG4gIC8vIFNlZTogaHR0cHM6Ly9leHByZXNzanMuY29tL2VuL2d1aWRlL2JlaGluZC1wcm94aWVzLmh0bWxcbiAgaWYgKGNvbmZpZy5zZXJ2ZXI/LnRydXN0UHJveHkpIHtcbiAgICBhcHAuc2V0KCd0cnVzdCBwcm94eScsIGNvbmZpZy5zZXJ2ZXIudHJ1c3RQcm94eSk7XG4gIH1cblxuICBhcHAudXNlKGNvcnMoKSk7XG5cbiAgLy8gUm91dGVyIHNldHVwXG4gIGFwcC51c2UobG9nKGNvbmZpZykpO1xuICBhcHAudXNlKGVycm9yUmVwb3J0aW5nTWlkZGxld2FyZSk7XG4gIGlmIChjb25maWcudXNlcl9hZ2VudCkge1xuICAgIGFwcC51c2UoZnVuY3Rpb24gKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gICAgICByZXMuc2V0SGVhZGVyKCdYLVBvd2VyZWQtQnknLCBnZXRVc2VyQWdlbnQoY29uZmlnLnVzZXJfYWdlbnQpKTtcbiAgICAgIG5leHQoKTtcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBhcHAuZGlzYWJsZSgneC1wb3dlcmVkLWJ5Jyk7XG4gIH1cblxuICBhcHAudXNlKGNvbXByZXNzaW9uKCkpO1xuXG4gIGFwcC5nZXQoJy8tL3N0YXRpYy9mYXZpY29uLmljbycsIHNlcnZlRmF2aWNvbihjb25maWcpKTtcblxuICAvLyBIb29rIGZvciB0ZXN0cyBvbmx5XG4gIGlmIChjb25maWcuX2RlYnVnKSB7XG4gICAgaG9va0RlYnVnKGFwcCwgY29uZmlnLnNlbGZfcGF0aCk7XG4gIH1cblxuICAvLyByZWdpc3RlciBtaWRkbGV3YXJlIHBsdWdpbnNcbiAgY29uc3QgcGx1Z2luX3BhcmFtcyA9IHtcbiAgICBjb25maWc6IGNvbmZpZyxcbiAgICBsb2dnZXI6IGxvZ2dlcixcbiAgfTtcblxuICBjb25zdCBwbHVnaW5zOiBJUGx1Z2luTWlkZGxld2FyZTxJQ29uZmlnPltdID0gbG9hZFBsdWdpbihjb25maWcsIGNvbmZpZy5taWRkbGV3YXJlcywgcGx1Z2luX3BhcmFtcywgZnVuY3Rpb24gKHBsdWdpbjogSVBsdWdpbk1pZGRsZXdhcmU8SUNvbmZpZz4pIHtcbiAgICByZXR1cm4gcGx1Z2luLnJlZ2lzdGVyX21pZGRsZXdhcmVzO1xuICB9KTtcbiAgcGx1Z2lucy5mb3JFYWNoKChwbHVnaW46IElQbHVnaW5NaWRkbGV3YXJlPElDb25maWc+KSA9PiB7XG4gICAgcGx1Z2luLnJlZ2lzdGVyX21pZGRsZXdhcmVzKGFwcCwgYXV0aCwgc3RvcmFnZSk7XG4gIH0pO1xuXG4gIC8vIEZvciAgbnBtIHJlcXVlc3RcbiAgYXBwLnVzZShhcGlFbmRwb2ludChjb25maWcsIGF1dGgsIHN0b3JhZ2UpKTtcblxuICAvLyBGb3IgV2ViVUkgJiBXZWJVSSBBUElcbiAgaWYgKF8uZ2V0KGNvbmZpZywgJ3dlYi5lbmFibGUnLCB0cnVlKSkge1xuICAgIGFwcC51c2UoJy8nLCB3ZWIoY29uZmlnLCBhdXRoLCBzdG9yYWdlKSk7XG4gICAgYXBwLnVzZSgnLy0vdmVyZGFjY2lvLycsIHdlYkFQSShjb25maWcsIGF1dGgsIHN0b3JhZ2UpKTtcbiAgfSBlbHNlIHtcbiAgICBhcHAuZ2V0KCcvJywgZnVuY3Rpb24gKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKSB7XG4gICAgICBuZXh0KEVycm9yQ29kZS5nZXROb3RGb3VuZChBUElfRVJST1IuV0VCX0RJU0FCTEVEKSk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBDYXRjaCA0MDRcbiAgYXBwLmdldCgnLyonLCBmdW5jdGlvbiAocmVxOiAkUmVxdWVzdEV4dGVuZCwgcmVzOiAkUmVzcG9uc2VFeHRlbmQsIG5leHQ6ICROZXh0RnVuY3Rpb25WZXIpIHtcbiAgICBuZXh0KEVycm9yQ29kZS5nZXROb3RGb3VuZChBUElfRVJST1IuRklMRV9OT1RfRk9VTkQpKTtcbiAgfSk7XG5cbiAgYXBwLnVzZShmdW5jdGlvbiAoZXJyOiBIdHRwRXJyb3IsIHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKSB7XG4gICAgaWYgKF8uaXNFcnJvcihlcnIpKSB7XG4gICAgICBpZiAoZXJyLmNvZGUgPT09ICdFQ09OTkFCT1JUJyAmJiByZXMuc3RhdHVzQ29kZSA9PT0gSFRUUF9TVEFUVVMuTk9UX01PRElGSUVEKSB7XG4gICAgICAgIHJldHVybiBuZXh0KCk7XG4gICAgICB9XG4gICAgICBpZiAoXy5pc0Z1bmN0aW9uKHJlcy5sb2NhbHMucmVwb3J0X2Vycm9yKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgLy8gaW4gY2FzZSBvZiB2ZXJ5IGVhcmx5IGVycm9yIHRoaXMgbWlkZGxld2FyZSBtYXkgbm90IGJlIGxvYWRlZCBiZWZvcmUgZXJyb3IgaXMgZ2VuZXJhdGVkXG4gICAgICAgIC8vIGZpeGluZyB0aGF0XG4gICAgICAgIGVycm9yUmVwb3J0aW5nTWlkZGxld2FyZShyZXEsIHJlcywgXy5ub29wKTtcbiAgICAgIH1cbiAgICAgIHJlcy5sb2NhbHMucmVwb3J0X2Vycm9yKGVycik7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEZhbGwgdG8gTWlkZGxld2FyZS5maW5hbFxuICAgICAgcmV0dXJuIG5leHQoZXJyKTtcbiAgICB9XG4gIH0pO1xuXG4gIGFwcC51c2UoZmluYWwpO1xuXG4gIHJldHVybiBhcHA7XG59O1xuXG5leHBvcnQgZGVmYXVsdCAoYXN5bmMgZnVuY3Rpb24gKGNvbmZpZ0hhc2g6IGFueSk6IFByb21pc2U8YW55PiB7XG4gIHNldHVwKGNvbmZpZ0hhc2gubG9ncyk7XG4gIGNvbnN0IGNvbmZpZzogSUNvbmZpZyA9IG5ldyBBcHBDb25maWcoXy5jbG9uZURlZXAoY29uZmlnSGFzaCkpO1xuICAvLyByZWdpc3RlciBtaWRkbGV3YXJlIHBsdWdpbnNcbiAgY29uc3QgcGx1Z2luX3BhcmFtcyA9IHtcbiAgICBjb25maWc6IGNvbmZpZyxcbiAgICBsb2dnZXI6IGxvZ2dlcixcbiAgfTtcbiAgY29uc3QgZmlsdGVycyA9IGxvYWRQbHVnaW4oY29uZmlnLCBjb25maWcuZmlsdGVycyB8fCB7fSwgcGx1Z2luX3BhcmFtcywgKHBsdWdpbjogSVBsdWdpblN0b3JhZ2VGaWx0ZXI8SUNvbmZpZz4pID0+IHBsdWdpbi5maWx0ZXJfbWV0YWRhdGEpO1xuICBjb25zdCBzdG9yYWdlOiBJU3RvcmFnZUhhbmRsZXIgPSBuZXcgU3RvcmFnZShjb25maWcpO1xuICAvLyB3YWl0cyB1bnRpbCBpbml0IGNhbGxzIGhhdmUgYmVlbiBpbml0aWFsaXplZFxuICBhd2FpdCBzdG9yYWdlLmluaXQoY29uZmlnLCBmaWx0ZXJzKTtcbiAgcmV0dXJuIGRlZmluZUFQSShjb25maWcsIHN0b3JhZ2UpO1xufSk7XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQStCO0FBRS9CLE1BQU1BLFNBQVMsR0FBRyxVQUFVQyxNQUFlLEVBQUVDLE9BQXdCLEVBQU87RUFBQTtFQUMxRSxNQUFNQyxJQUFXLEdBQUcsSUFBSUMsYUFBSSxDQUFDSCxNQUFNLENBQUM7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